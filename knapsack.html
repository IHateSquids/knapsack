<!DOCTYPE html>
<html>
<head>cd
	<meta charset='utf-8'>
	<meta http-equiv='X-UA-Compatible' content='IE=edge'>
	<title>Knapsack Visualiser</title>
	<meta name='viewport' content='width=device-width, initial-scale=1'>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
	<style></style>
		body{
		    background-size: cover;
		    overflow-x: hidden;
		    scroll-behavior: smooth;
		}

		.headarea h1{  
		    margin: 10px 0px;
		    text-align: center;
		}

		#ans{
		    background-color: rgba(44, 86, 47, 0.8);
		    color: white;
			width: max-content;
			height: max-content;
		    padding: 10px;
		    border-radius: 10px;
		}

		#data, #data2{
			width: max-content;
			height: max-content;
		    margin: auto;
			margin-top: 20px;
		    transition-duration: 1s;
		}

		#data2 table tr td{
		    background-color: rgba(153, 255, 153, 0.95);
		    text-align: center;
		    font-size: large;
		    font-weight: bold;
		    height: 60px;
		    width: 60px;
		    border: 2px solid black;
		}

		#data2 table tr th{
		    background-color: rgba(100, 100, 100, 0.9);
		    color: white;
		    text-align: center;
		    font-size: small;
		    font-weight: bold;
		    height: 60px;
		    width: 60px;
		    border: 2px solid black;
		    padding: 2px;
		}

		.item-header {
		    background-color: rgba(70, 130, 180, 0.9) !important;
		    color: white;
		    font-size: 10px;
		    padding: 1px;
		}

		#itemTable table {
		    margin: auto;
		}

		#itemTable table tr td, #itemTable table tr th {
		    background-color: rgba(173, 216, 230, 0.9);
		    text-align: center;
		    font-size: medium;
		    font-weight: bold;
		    padding: 8px;
		    border: 1px solid black;
		}

		.current-step {
		    background-color: rgba(255, 165, 0, 0.8) !important;
		    animation: pulse 1s infinite;
		}

		@keyframes pulse {
		    0% { opacity: 0.7; }
		    50% { opacity: 1; }
		    100% { opacity: 0.7; }
		}

		.customB{
		    margin: auto;
		    margin-top: 15px;
		    width: fit-content;
		}

		.cola{
		    background-color: rgba(44, 86, 47, 1) !important;
		    color: white;
		}

		.colb{
		    background-color: rgba(255, 223, 13, 0.95) !important;
		}

		.hide{
		    visibility: hidden;
		}
	</style>
</head>
<body>
	<div class="headarea">
		<h1>0/1 Knapsack Algorithm Visualiser</h1>
	</div><hr/>

	<div class="row g-5">
		<div class="col-1"></div>
		<div class="col-auto">
			<label class="form-label" for="profit">Enter Profit Array</label>
			<input class="form-control p-2 shadow rounded" placeholder="Ex: 3 2 4 5" type="text" id="profit">
		</div>
		<div class="col-auto">
			<label class="form-label" for="weight">Enter Weight Array</label>
			<input class="form-control p-2 shadow rounded" placeholder="Ex: 4 1 2 6" type="text" id="weight">
		</div>
		<div class="col-auto">
			<label class="form-label" for="maxw">Enter Max Weight</label>
			<input class="form-control p-2 shadow rounded" placeholder="Ex: 12" type="number" id="maxw">
		</div>
	</div>

	<div id="itemInfo" class="mt-3" style="display: none;">
		<div class="container">
			<h5>Items Information:</h5>
			<div id="itemTable" class="mb-3"></div>
		</div>
	</div>

	<div id="data"><h3 id="ans"></h3></div>
	<div id="data2"><table id="table"></table></div>

	<div class="customB">
		<button class="btn-lg btn-primary px-4" type="submit" onclick="start()" id="startBtn">Start</button>
		<button class="btn-lg btn-secondary px-4 mx-3" onclick="prevStep()" id="prevBtn" style="display: none;">Previous Step</button>
		<button class="btn-lg btn-success px-4 mx-3" onclick="nextStep()" id="nextBtn" style="display: none;">Next Step</button>
		<button class="btn-lg btn-warning px-4" onclick="reset()" id="resetBtn" style="display: none;">Reset</button>
	</div>

<script>
	let globalData = null;
	let currentStep = 0;
	let totalSteps = 0;
	let steps = [];
	let stepsDPStates = [];

	function start(){
	    let p=document.getElementById("profit").value;
	    let w=document.getElementById("weight").value;
	    let maxw=document.getElementById("maxw").value;
	    if(p && w && maxw){
	        maxw=parseInt(maxw);
	        p=p.split(" ").map(Number);
	        w=w.split(" ").map(Number);
	        
	        // Check if profit and weight arrays have the same length
	        if (p.length !== w.length) {
	            alert("Profit and Weight arrays must have the same number of items!");
	            return;
	        }

	        let n=w.length;
	        
	        // Initialize DP table
	        let dp=new Array(n+1);
	        for (let i = 0; i <= n; i++) {
	            dp[i] = new Array(maxw+1).fill(0);
	        }
	        globalData = {n, w, p, maxw, dp};
	        
	        showItemInfo(p, w);
	        createTable(dp, n, maxw, w, p);
	        
	        document.getElementById("startBtn").style.display = "none";
	        document.getElementById("nextBtn").style.display = "inline-block";
	        document.getElementById("prevBtn").style.display = "inline-block";
	        document.getElementById("resetBtn").style.display = "inline-block";
	        
	        currentStep = 0;
	        generateSteps(n, maxw);
	        showInitialState();
	        updatePrevNextButtons();
	    }
	    else{
	        alert("Please Fill All Fields!");
	    }
	}

	function showItemInfo(p, w) {
	    const itemInfo = document.getElementById("itemInfo");
	    const itemTable = document.getElementById("itemTable");
	    let tableHTML = `
	        <table style="margin: auto;">
	            <tr>
	                <th>Item</th>
	                ${p.map((_, i) => `<th>${i + 1}</th>`).join('')}
	            </tr>
	            <tr>
	                <th>Profit</th>
	                ${p.map(profit => `<td>${profit}</td>`).join('')}
	            </tr>
	            <tr>
	                <th>Weight</th>
	                ${w.map(weight => `<td>${weight}</td>`).join('')}
	            </tr>
	        </table>
	    `;
	    itemTable.innerHTML = tableHTML;
	    itemInfo.style.display = "block";
	}

	function copyDP(dp) {
	    return dp.map(row => [...row]);
	}

	function generateSteps(n, maxw) {
	    steps = [];
	    stepsDPStates = [];
	    
	    // Save initial state
	    stepsDPStates.push(copyDP(globalData.dp));
	    steps.push({ type: 'initial', message: 'Base cases initialized.' });

	    for (let i = 1; i <= n; i++) {
	        for (let j = 1; j <= maxw; j++) {
	            const step = {
	                type: 'calculate',
	                i: i, 
	                j: j,
	                item: i,
	                weight: globalData.w[i-1],
	                profit: globalData.p[i-1]
	            };
	            steps.push(step);
	        }
	    }
	    steps.push({ type: 'final', message: 'Algorithm completed! Click Previous Step to see the path.' });
	    totalSteps = steps.length;
	}

	function processStep(stepIndex) {
	    const step = steps[stepIndex];
	    if (step.type ===	 'initial') {
	        showStepMessage(`Step ${stepIndex + 1}: ${step.message}`);
	        stepsDPStates.push(copyDP(globalData.dp));
	    } else if (step.type === 'calculate') {
	        calculateAndShowStep(step);
	    } else if (step.type === 'final') {
	        showFinalResult();
	    }
	}

	function nextStep() {
	    if (currentStep < totalSteps) {
	        processStep(currentStep);
	        currentStep++;
	        updatePrevNextButtons();
	    }
	}

	function prevStep() {
	    if (currentStep > 0) {
	        currentStep--;
	        if (steps[currentStep].type === 'calculate') {
	            // Restore previous DP state
	            globalData.dp = copyDP(stepsDPStates[currentStep]);
	            updateTableToStep(currentStep);
	        }
	        showStepForCurrentState();
	        updatePrevNextButtons();
	    }
	}

	function updateTableToStep(stepIndex) {
	    const {n, maxw} = globalData;
	    const table = document.getElementById("table");
	    
	    // Hide all cells first
	    const allCells = table.getElementsByTagName("td");
	    for (let cell of allCells) {
	        cell.classList.add("hide");
	    }
	    
	    // Show cells up to current step
	    for (let i = 0; i <= n; i++) {
	        for (let j = 0; j <= maxw; j++) {
	            // Show base cases (first row and first column)
	            if (i === 0 || j === 0) {
	                const cell = table.rows[i+1].cells[j+1];
	                cell.textContent = globalData.dp[i][j];
	                cell.classList.remove("hide");
	                continue;
	            }
	            
	            // Calculate which steps have been processed
	            const stepsProcessed = (i-1) * maxw + j;
	            if (stepsProcessed <= stepIndex) {
	                const cell = table.rows[i+1].cells[j+1];
	                cell.textContent = globalData.dp[i][j];
	                cell.classList.remove("hide");
	            }
	        }
	    }
	}

	function showStepForCurrentState() {
	    if (currentStep < steps.length) {
	        const step = steps[currentStep];
	        if (step.type === 'initial') {
	            showStepMessage(`Step ${currentStep + 1}: ${step.message}`);
	            clearHighlighting();
	            showInitialState();
	        } else if (step.type === 'calculate') {
	            const {i, j, item, weight, profit} = step;
	            let message = `Step ${currentStep + 1}: Item ${item} (W:${weight}, P:${profit}) Capacity ${j}`;
	            
	            if (weight <= j) {
	                const exclude = globalData.dp[i-1][j];
	                const include = profit + globalData.dp[i-1][j-weight];
	                message += `\nFits! Max(${exclude}, ${include}) = ${globalData.dp[i][j]}`;
	            } else {
	                message += `\nToo heavy! Value: ${globalData.dp[i][j]}`;
	            }
	            
	            showStepMessage(message);
	            highlightCurrentStep(step);
	        } else if (step.type === 'final') {
	            showFinalResult();
	        }
	    }
	}

	function highlightCurrentStep(step) {
	    clearHighlighting();
	    const {i, j, weight} = step;
	    const table = document.getElementById("table");
	    
	    // Highlight current cell
	    const currentCell = table.rows[i+1].cells[j+1];
	    currentCell.classList.add("current-step");
	    
	    // Highlight reference cells
	    const excludeCell = table.rows[i].cells[j+1];
	    excludeCell.classList.add("colb");
	    
	    if (weight <= j) {
	        const includeCell = table.rows[i].cells[j-weight+1];
	        includeCell.classList.add("colb");
	    }
	}

	function calculateAndShowStep(step) {
	    const {i, j, item, weight, profit} = step;
	    const dp = globalData.dp;
	    
	    // Save state before calculation
	    stepsDPStates.push(copyDP(dp));
	    
	    if (weight <= j) {
	        dp[i][j] = Math.max(dp[i-1][j], profit + dp[i-1][j-weight]);
	    } else {
	        dp[i][j] = dp[i-1][j];
	    }
	    
	    updateTableToStep(currentStep);
	    showStepForCurrentState();
	}

	function clearHighlighting() {
	    const table = document.getElementById("table");
	    if (!table) return;
	    const cells = table.getElementsByTagName("td");
	    for (let cell of cells) {
	        cell.classList.remove("cola", "colb", "current-step");
	    }
	}

	function showStepMessage(message) {
	    const data = document.getElementById("data");
	    let ans = document.getElementById("ans");
	    if (!ans) {
	        ans = document.createElement("h3");
	        ans.id = "ans";
	        data.appendChild(ans);
	    }
	    ans.style.whiteSpace = "pre-line";
	    ans.textContent = message;
	}

	function showInitialState() {
	    const table = document.getElementById("table");
	    if (!table) return;
	    const {n, maxw} = globalData;
	    
	    // Show the first row and column (base cases)
	    for (let j = 0; j <= maxw; j++) {
	        const cell = table.rows[1].cells[j+1];
	        cell.textContent = globalData.dp[0][j];
	        cell.classList.remove("hide");
	    }
	    for (let i = 0; i <= n; i++) {
	        const cell = table.rows[i+1].cells[1];
	        cell.textContent = globalData.dp[i][0];
	        cell.classList.remove("hide");
	    }
	    
	    showStepMessage("Ready! Click 'Next Step' to start.");
	}

	function showFinalResult() {
	    const {n, w, p, maxw, dp} = globalData;
	    let str = "Max Profit: " + dp[n][maxw] + " | Included Items: ";
	    let temp = dp[n][maxw];
	    let includedItems = [];
	    let tempMaxw = maxw;
	    
	    for (let i = n; i > 0; i--) {
	        if (temp == dp[i-1][tempMaxw]) continue;
	        includedItems.push(i);
	        tempMaxw -= w[i-1];
	        temp -= p[i-1];
	    }
	    
	    str += includedItems.reverse().join(", ");
	    showStepMessage(str);
	    
	    // Highlight the optimal path
	    highlightOptimalPath(n, maxw);
	}

	function highlightOptimalPath(n, maxw) {
	    const {dp, w} = globalData;
	    let tempMaxw = maxw;
	    clearHighlighting();
	    
	    for (let i = n; i > 0; i--) {
	        if (dp[i][tempMaxw] !== dp[i-1][tempMaxw]) {
	            const table = document.getElementById("table");
	            const cell = table.rows[i+1].cells[tempMaxw+1];
	            cell.classList.add("cola");
	            tempMaxw -= w[i-1];
	        }
	    }
	}

	function updatePrevNextButtons() {
	    document.getElementById("prevBtn").style.display = currentStep > 0 ? "inline-block" : "none";
	    document.getElementById("nextBtn").style.display = currentStep < totalSteps ? "inline-block" : "none";
	}

	function reset() {
	    globalData = null;
	    currentStep = 0;
	    totalSteps = 0;
	    steps = [];
	    stepsDPStates = [];
	    document.getElementById("itemInfo").style.display = "none";
	    document.getElementById("data2").style.opacity = 0;
	    document.getElementById("startBtn").style.display = "inline-block";
	    document.getElementById("nextBtn").style.display = "none";
	    document.getElementById("prevBtn").style.display = "none";
	    document.getElementById("resetBtn").style.display = "none";
	    const ans = document.getElementById("ans");
	    if(ans){
	        ans.remove();
	    }
	    setTimeout(() => {
	        const table = document.getElementById("table");
	        if(table){
	            table.remove();
	        }
	    }, 1000);
	    document.getElementById("profit").value = "";
	    document.getElementById("weight").value = "";
	    document.getElementById("maxw").value = "";
	}

	function createTable(dp, n, maxw, w, p){
	    const data=document.getElementById("data2");
	    if(document.getElementById("table")){
	        data.style.opacity=0;
	        setTimeout(() => {
	            data.removeChild(document.getElementById("table"));
	        }, 1000);
	    }
	    let table=document.createElement("table");
	    const headerRow = document.createElement("tr");
	    const emptyCorner = document.createElement("th");
	    emptyCorner.appendChild(document.createTextNode("Item\\Weight"));
	    headerRow.appendChild(emptyCorner);
	    for (let j = 0; j <= maxw; j++) {
	        const headerCell = document.createElement("th");
	        headerCell.appendChild(document.createTextNode(j));
	        headerRow.appendChild(headerCell);
	    }
	    table.appendChild(headerRow);
	    for (let i = 0; i <= n; i++) {
	        const row = document.createElement("tr");
	        const rowHeader = document.createElement("th");
	        if (i === 0) {
	            rowHeader.appendChild(document.createTextNode("0"));
	        } else {
	            rowHeader.classList.add("item-header");
	            rowHeader.innerHTML = `Item ${i}<br>W:${w[i-1]}<br>P:${p[i-1]}`;
	        }
	        row.appendChild(rowHeader);
	        for (let j = 0; j <= maxw; j++) {
	            const cell = document.createElement("td");
	            const val = document.createTextNode(dp[i][j]);
	            cell.appendChild(val);
	            cell.classList.add("hide");
	            row.appendChild(cell);
	        }
	        table.appendChild(row);
	    }
	    table.id="table";
	    setTimeout(() => {
	        data.appendChild(table);
	        data.style.opacity=1;
	    }, 1000);
	}
</script>
</body>
</html>